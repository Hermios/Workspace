package mamshops.resources.dynamicimages;

import java.io.File;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.HashMap;

import org.apache.commons.io.FileUtils;
import org.apache.commons.lang.RandomStringUtils;

import mamshops.tools.entries.EnumPropertieKeys;
import mamshops.tools.entries.PropertiesManager;
import mamshops.tools.utils.PathConstructor;

public class ExternalWebsiteHelper {
	private static HashMap<String,String> _mapWebsitesCodes=new HashMap<>();
	
	
	public String ImageHandler(String webSiteRoot,String pictureUrl)
	{
		if(!_mapWebsitesCodes.containsKey(webSiteRoot))
			_mapWebsitesCodes.put(webSiteRoot, RandomStringUtils.randomAlphanumeric(25));
		String picturePath=PathConstructor.getPath(_mapWebsitesCodes.get(webSiteRoot),pictureUrl);		
		File pictureFile=new File(PropertiesManager.getString(EnumPropertieKeys.TEMP_DIRECTORY),picturePath);
		if(pictureFile.exists())
			return picturePath;
		if(!pictureFile.getParentFile().exists())
			pictureFile.getParentFile().mkdirs();
		try {
			URL pictureFullUrl = new URL(PathConstructor.getURL(webSiteRoot,pictureUrl));
			FileUtils.copyURLToFile(pictureFullUrl, pictureFile);
			
		} catch (MalformedURLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return "";
	}
}
